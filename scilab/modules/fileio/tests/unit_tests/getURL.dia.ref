// =============================================================================
// Scilab ( http://www.scilab.org/ ) - This file is part of Scilab
// Copyright (C) 2011 - Sylvestre LEDRU
// Copyright (C) 2013 - Scilab Enterprises
//
//  This file is distributed under the same license as the Scilab package.
// =============================================================================
function checkFile(filename, expectedFileName, minimalFileSize)
    assert_checkequal(filename, expectedFileName)
    info = fileinfo(filename);
    assert_checktrue(info(1) > minimalFileSize);
    deletefile(filename);
endfunction
function checkFileAndContent(filename, expectedFileName, minimalFileSize, keywordToFind)
	fd = mopen(filename, "r");
	assert_checktrue(grep(mgetl(fd), keywordToFind) <> []);
	mclose(fd);
	checkFile(filename, expectedFileName, minimalFileSize);
endfunction
function checkContent(filename, content, keyword, keywordToFind)
	assert_checktrue(length(content) > 10);
	assert_checktrue(grep(content, keywordToFind) <> []);
	deletefile(filename);
endfunction
cd TMPDIR;
// Check downloaded file
filename = getURL("http://www.scilab.org");
checkFile(filename, "index.html", 1000);
filename = getURL("http://www.scilab.org/");
checkFile(filename, "index.html", 1000);
filename = getURL("ftp://ftp.free.fr/pub/Distributions_Linux/debian/README");
checkFile(filename, "README", 10);
targetFile = TMPDIR + "/README_Debian";
filename = getURL("ftp://ftp.free.fr/pub/Distributions_Linux/debian/README", targetFile);
checkFileAndContent(filename, targetFile, 10, "Linux");
filename = getURL("ftp://ftp.free.fr/pub/Distributions_Linux/debian/README", TMPDIR);
checkFileAndContent(filename, TMPDIR + "/README", 10, "Linux");
// HTTPS
filename = getURL("https://encrypted.google.com");
checkFileAndContent(filename, "index.html", 100, "html");
targetFile = TMPDIR+"/testauth";
filename = getURL("http://httpbin.org/basic-auth/user/passwd", targetFile, "user", "passwd");
checkFileAndContent(filename, targetFile, 10, "authenticated");
// Check returned content
[f, content] = getURL("http://www.scilab.org:80");
checkContent(f, content, 1000, "html");
[f, content] = getURL("http://plop:ae@www.scilab.org:80");
checkContent(f, content, 1000, "html");
[f, content] = getURL("http://www.scilab.org/aze");
checkContent(f, content, 100, "aze");
[f, content] = getURL("http://www.scilab.org");
checkContent(f, content, 1000, "html");
[f, content] = getURL("http://www.scilab.org/");
checkContent(f, content, 1000, "html");
[f, content] = getURL("ftp://ftp.free.fr/pub/Distributions_Linux/debian/README");
checkContent(f, content, 10, "Linux");
// HTTPS
[f, content] = getURL("https://encrypted.google.com");
checkContent(f, content, 100, "html");
[f, content] = getURL("http://httpbin.org/basic-auth/user/passwd", TMPDIR, "user", "passwd");
checkContent(f, content, 10, "authenticated");
// Badly formated URL
assert_checkerror("getURL(''http://plop@ae:www.scilab.org:80'');", [], 999);
