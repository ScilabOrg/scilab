// =============================================================================
// Scilab ( http://www.scilab.org/ ) - This file is part of Scilab
// Copyright (C) 2008 - INRIA -
//
//  This file is distributed under the same license as the Scilab package.
// =============================================================================
//===============================
// unit tests Toolboxes functions
//===============================
// on modifie la position du dossier contenant les toolboxes pour les tests
function rep = toolboxDirectory()
  rep = "home/dev/package_manager/modules/atoms/tests/unit_tests/toolboxes/"
endfunction
Warning : redefining function: toolboxDirectory        . Use funcprot(0) to avoid this message

// lecture DESCRIPTION en local (/!\ l'ordre des champs importe pour la comparaison verif <> test)
verif("Toolbox") = "testA";
verif("Version") = "1.0.0";
verif("Title") = "TestA";
verif("Author") = "Delphine";
verif("Maintainer") = "Delphine";
verif("Description") = "Test de code scilab pour lire les DESCRIPTION. Avec une ligne de description qui est plus longue que la longueur d''une ligne, pour tester les lignes multiples.";
verif("License") = "Aucune";
verif("Category") = "essai";
verif("ScilabVersion") = ">= 5.0";
verif("Date") = "2008-03-31";
verif("Depends") = "testB, testC, testH";
verif("ExternalDepends") = "";
verif("URL") = "";
verif("Entity") = "";
verif("Function")("1") = "Toolbox - testA, TestA";
verif("Function")("2") = "mafonction1 - ma super fonction fait le cafe";
verif("Function")("3") = "mafonction2 - ma super fonction 2 fait le menage";
verif("Function")("4") = "mafonction3 - ma super fonction 3 fait la vaisselle, lave le linge, repasse, lave la cuisine et la salle de bain, il ne lui manque rien de rien.";
verif("Function")("5") = "mafonction4 - ne sert a rien";
test = readDescription("testA"); if verif <> test then bugmes();quit;end;
// chargement de toutes les toolbox sur un mirror
function listMirror = toolboxMirror()
  listMirror = ["http://128.93.23.238/scilab/src/contrib"]
endfunction
Warning : redefining function: toolboxMirror           . Use funcprot(0) to avoid this message

test = readDescription("");
[n, m] = size(test("Toolbox")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("Version")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("Title")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("Author")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("Maintainer")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("Description")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("License")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("Category")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("ScilabVersion")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("Date")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("Depends")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("ExternalDepends")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("URL")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("Entity")); if n <> 20 then bugmes();quit;end;
[n, m] = size(test("Function")); if n <> 20 then bugmes();quit;end;
// on choisi un Mirror non conforme
function listMirror = toolboxMirror()
  listMirror = ["http://128.93.23.238/scilab/bin/linux/contrib"];
endfunction
Warning : redefining function: toolboxMirror           . Use funcprot(0) to avoid this message

// chargement de toutes les toolbox sur le web
test = readDescription(""); if size(test("Toolbox")) <> 0 then bugmes();quit;end;
 
 --17:05:36--  http://128.93.23.238/scilab/bin/linux/contrib/TOOLBOXES  
 
 Verifiez la validite du repository   
// on remet les bon Mirrors
function listMirror = toolboxMirror()
  listMirror = ["http://128.93.23.238/scilab/src/contrib", "http://128.93.23.238/scilab/bin/windows/contrib"];
endfunction
Warning : redefining function: toolboxMirror           . Use funcprot(0) to avoid this message

// installation avec la dernière dependance non présente sur le web ni en local
if installToolbox("testA") <> %f then bugmes();quit;end;
 
 Toolbox testH non trouvee   
 
 La version de la Toolbox testC presente localement n'est pas la bonne. 
       Updatez la.                                                      
// installation avec conflit versions
if installToolbox("conflitA") <> %f then bugmes();quit;end;
 
 La version de la Toolbox conflitB presente localement n'est pas la bon 
      ne. Updatez la.                                                   
// installation avec la dépendance locale ne vérifiant pas la condition
if installToolbox("local1") <> %f then bugmes();quit;end;
 
 La version de la Toolbox local1 presente localement n'est pas la bonne 
      . Updatez la.                                                     
// supression de toolbox non présente
if removeToolbox("non") <> %f then bugmes();quit;end;
 
 La toolbox non n'est pas installee   
// update d'une toolbox non présente
if updateToolbox("non") <> %f then bugmes();quit;end;
 
 La toolbox non n'est pas installee   
// update d'une toolbox non présente sur le net
if updateToolbox("truc") <> %f then bugmes();quit;end;
 
 Toolbox non disponible sur le net   
// update d'une toolbox dependance d'une autre
function listMirror = toolboxMirror()
  listMirror = ["http://128.93.23.238/scilab/src/contrib"];
endfunction
Warning : redefining function: toolboxMirror           . Use funcprot(0) to avoid this message

if installToolbox("updateA") <> %t then bugmes();quit;end;
 
 Va etre installe : updateA   
 
 Va etre installe : updateB   
function listMirror = toolboxMirror()
  listMirror = ["http://128.93.23.238/scilab/src/contrib", "http://128.93.23.238/scilab/bin/macosX/contrib"];
endfunction
Warning : redefining function: toolboxMirror           . Use funcprot(0) to avoid this message

// Mauvaise version
if updateToolbox("updateB") <> %f then bugmes();quit;end;
 
 Le fichier DESCRIPTION-FUNCTIONS de la toolbox updateB est manquant   
 
 Le fichier DESCRIPTION-FUNCTIONS de la toolbox updateA est manquant   
 
 probleme de dependance   
function listMirror = toolboxMirror()
  listMirror = ["http://128.93.23.238/scilab/src/contrib", "http://128.93.23.238/scilab/bin/windows/contrib"];
endfunction
Warning : redefining function: toolboxMirror           . Use funcprot(0) to avoid this message

// Bonne version
if updateToolbox("updateB") <> %t then bugmes();quit;end;
 
 Le fichier DESCRIPTION-FUNCTIONS de la toolbox updateB est manquant   
 
 Le fichier DESCRIPTION-FUNCTIONS de la toolbox updateA est manquant   
 
 Le fichier DESCRIPTION-FUNCTIONS de la toolbox updateB est manquant   
 
 La toolbox updateB va etre update en version 1.2.2   
 
 Va etre installe : updateB   
 
 --17:05:38--  http://128.93.23.238/scilab/src/contrib/updateB.1.2.2.ta 
      r.gz                                                              
// Suppression des toolboxes
if removeToolbox("updateA") <> %t then bugmes();quit;end;
 
 Le fichier DESCRIPTION-FUNCTIONS de la toolbox updateA est manquant   
 
 Le fichier DESCRIPTION-FUNCTIONS de la toolbox updateB est manquant   
 
 updateA supprime   
if removeToolbox("updateB") <> %t then bugmes();quit;end;
 
 Le fichier DESCRIPTION-FUNCTIONS de la toolbox updateB est manquant   
 
 updateB supprime   
