// ============================================================================
// Scilab ( http://www.scilab.org/ ) - This file is part of Scilab
// Copyright (C) 2010 - DIGITEO - Cl√©ment DAVID
//
//  This file is distributed under the same license as the Scilab package.
// ============================================================================
//
// <-- ENGLISH IMPOSED -->
//
// <-- Short Description -->
// Blocks must have valid dimensions for their settings.
// Some dimensions were not coherents between theirs "set" and "define" method.
loadXcosLibs();
defaultlibs = ["Branching",
               "Electrical",
               "Hydraulics",
               "Linear",
               "Sources",
               "Misc",
               "Events",
               "Integerop",
               "Matrixop",
               "Nonlinear",
               "Sinks",
               "Threshold"];
defaultlibs  = defaultlibs + "lib";
notTested = ["SUPER_f" "TEXT_f" "PAL_f", ..         // Specific blocks-
             "CBLOCK4" "CBLOCK"];                   // buggy blocks #7363
funcprot(0);
ilib_verbose(0);
// Stubbing the x_mdialog method
// checking it's arguments size only
function [result]=x_mdialog(title, labelsv, labelsh, default_inputs_vector)
    [lhs, rhs] = argn();
    if rhs == 3 then
        default_inputs_vector = labelsh;
        result = x_dialog(labelsv, default_inputs_vector);
    elseif rhs == 4 then
        vSize = size(labelsv, '*');
        hSize = size(labelsh, '*');
        if size(default_inputs_vector) <> [vSize, hSize] then
            mprintf("%s\nError: dialog wrong size.", cmd); bugmes();quit;end;
        result = default_inputs_vector;
    else
        mprintf("%s\nError: dialog wrong size.", cmd); bugmes();quit;end;
endfunction
// Stubbing the x_dialog method
// checking it's arguments size only
function [result]=x_dialog(labels, default_inputs_vector)
    if(or(size(labels) <> size(default_inputs_vector))) then
        mprintf("%s\nError: dialog wrong size.", cmd); bugmes();quit;end;
    result = default_inputs_vector;
endfunction
// Stubbing the dialog method
// checking nothing
function [result]=x_dialog(labels,default_inputs_vector)
    result = default_inputs_vector;
endfunction
// Stubbing the edit_curv method
function [xx, yy, ok, gc] = edit_curv(xx, yy,  axis, args, gc)
    ok = %T;
    if ~exists("gc", 'l') then
        rect=[0 0 1 1];
        axisdata=[2 10 2 10];
        gc = list(rect, axisdata);
    end
endfunction
// Stubbing the messagebox method
function [btn] = messagebox(msg, msgboxtitle, msgboxicon, buttons, ismodal)
    btn=1;
endfunction
// Stubbing global scicos flags
needcompile = 0;
alreadyran = %f;
%scicos_context = struct();
// If the following block display something, the test is failed.
for i = 1:size(defaultlibs,"*")
    [macros, path] = libraryinfo(defaultlibs(i));
    for j = 1:size(macros,"*")
        interfunction = macros(j);
        // Not tested blocks (Xcos customs)
        if or(interfunction == notTested) then
          continue;
        end
        // Check for signature
        vars=macrovar(evstr(interfunction));
        if or([size(vars(1)) <> [3 1] , size(vars(2)) <> [3 1]]) then
          mprintf("%s is not a valid block descriptor.\n", interfunction);
          continue;
        end
        // New Scilab instance
        cmd = "scs_m=" + interfunction + "(""define"", [], []);";
        if execstr(cmd, "errcatch")<>0 then
            mprintf("%s\n",cmd); bugmes();quit;end
        cmd = "scs_m=" + interfunction + "(""set"", scs_m, []);";
        if execstr(cmd, "errcatch")<>0 then
            mprintf("%s\n",cmd); bugmes();quit;end
        // Exported hdf5 instance
        filePath = SCI + "/modules/scicos_blocks/blocks/" + interfunction + ".h5";
        if isfile(filePath) <> %t then
            mprintf("%s not found.\n", filePath);
            continue;
        end
        if import_from_hdf5(filePath) <> %t then
            mprintf("%s not loaded\n", filePath); bugmes();quit;end
        // the saved data is stored as the out variable
        scs_m = out;
        cmd = "scs_m=" + interfunction + "(""set"", scs_m, []); // loaded block";
        if execstr(cmd, "errcatch")<>0 then
            mprintf("%s\n",cmd); bugmes();quit;end
    end
end
SCI/modules/scicos_blocks/blocks/MUX_f.h5 not found.
SCI/modules/scicos_blocks/blocks/SWITCH2.h5 not found.
SCI/modules/scicos_blocks/blocks/SELECT_f.h5 not found.
SCI/modules/scicos_blocks/blocks/ISELECT_f.h5 not found.
SCI/modules/scicos_blocks/blocks/SCALAR2VECTOR.h5 not found.
SCI/modules/scicos_blocks/blocks/DEMUX_f.h5 not found.
SCI/modules/scicos_blocks/blocks/MOTOR.h5 not found.
vanne_draw_ports is not a valid block descriptor.
bache_draw_ports is not a valid block descriptor.
vanne_outputs is not a valid block descriptor.
bache_inputs is not a valid block descriptor.
source_draw_ports is not a valid block descriptor.
source_inputs is not a valid block descriptor.
puit_inputs is not a valid block descriptor.
bache_outputs is not a valid block descriptor.
vanne_inputs is not a valid block descriptor.
SCI/modules/scicos_blocks/blocks/Flowmeter.h5 not found.
puit_draw_ports is not a valid block descriptor.
SCI/modules/scicos_blocks/blocks/DLR_f.h5 not found.
SCI/modules/scicos_blocks/blocks/DOLLAR.h5 not found.
SCI/modules/scicos_blocks/blocks/TCLSS_f.h5 not found.
SCI/modules/scicos_blocks/blocks/DIFF_c.h5 not found.
SCI/modules/scicos_blocks/blocks/CLSS_f.h5 not found.
SCI/modules/scicos_blocks/blocks/DOLLAR_m.h5 not found.
SCI/modules/scicos_blocks/blocks/SAMPHOLD.h5 not found.
SCI/modules/scicos_blocks/blocks/INTEGRAL.h5 not found.
SCI/modules/scicos_blocks/blocks/SOM_f.h5 not found.
SCI/modules/scicos_blocks/blocks/SAMPLEHOLD_f.h5 not found.
SCI/modules/scicos_blocks/blocks/REGISTER_f.h5 not found.
SCI/modules/scicos_blocks/blocks/DLSS_f.h5 not found.
SCI/modules/scicos_blocks/blocks/GAINBLK.h5 not found.
SCI/modules/scicos_blocks/blocks/CLR_f.h5 not found.
SCI/modules/scicos_blocks/blocks/GAIN_f.h5 not found.
SCI/modules/scicos_blocks/blocks/STEP.h5 not found.
SCI/modules/scicos_blocks/blocks/PULSE_SC.h5 not found.
SCI/modules/scicos_blocks/blocks/CONST.h5 not found.
SCI/modules/scicos_blocks/blocks/CLOCK_f.h5 not found.
SCI/modules/scicos_blocks/blocks/FROMWS_c.h5 not found.
SCI/modules/scicos_blocks/blocks/RAND_f.h5 not found.
SCI/modules/scicos_blocks/blocks/CURVE_c.h5 not found.
SCI/modules/scicos_blocks/blocks/CONST_f.h5 not found.
SCI/modules/scicos_blocks/blocks/CLKIN_f.h5 not found.
tkscaleblk is not a valid block descriptor.
SCI/modules/scicos_blocks/blocks/Ground_g.h5 not found.
SCI/modules/scicos_blocks/blocks/GEN_SQR.h5 not found.
SCI/modules/scicos_blocks/blocks/func_block.h5 not found.
anim_pen is not a valid block descriptor.
SCI/modules/scicos_blocks/blocks/DSUPER.h5 not found.
SCI/modules/scicos_blocks/blocks/generic_block.h5 not found.
SCI/modules/scicos_blocks/blocks/SPLIT_f.h5 not found.
SCI/modules/scicos_blocks/blocks/CONSTRAINT2_c.h5 not found.
SCI/modules/scicos_blocks/blocks/generic_block2.h5 not found.
SCI/modules/scicos_blocks/blocks/EDGETRIGGER.h5 not found.
SCI/modules/scicos_blocks/blocks/IMPSPLIT_f.h5 not found.
SCI/modules/scicos_blocks/blocks/MEMORY_f.h5 not found.
bplatform2 is not a valid block descriptor.
SCI/modules/scicos_blocks/blocks/PENDULUM_ANIM.h5 not found.
SCI/modules/scicos_blocks/blocks/scifunc_block.h5 not found.
SCI/modules/scicos_blocks/blocks/MPBLOCK.h5 not found.
m_sin is not a valid block descriptor.
SCI/modules/scicos_blocks/blocks/CLKSPLIT_f.h5 not found.
SCI/modules/scicos_blocks/blocks/EVTDLY_f.h5 not found.
SCI/modules/scicos_blocks/blocks/CLKSOM_f.h5 not found.
SCI/modules/scicos_blocks/blocks/VirtualCLK0.h5 not found.
SCI/modules/scicos_blocks/blocks/LOOKUP_c.h5 not found.
SCI/modules/scicos_blocks/blocks/EXPBLK_f.h5 not found.
SCI/modules/scicos_blocks/blocks/SAT_f.h5 not found.
SCI/modules/scicos_blocks/blocks/LOOKUP2D.h5 not found.
SCI/modules/scicos_blocks/blocks/FSV_f.h5 not found.
SCI/modules/scicos_blocks/blocks/INVBLK_f.h5 not found.
SCI/modules/scicos_blocks/blocks/ABSBLK_f.h5 not found.
SCI/modules/scicos_blocks/blocks/CLKOUT_f.h5 not found.
