// =============================================================================
// Scilab ( http://www.scilab.org/ ) - This file is part of Scilab
// Copyright (C) 2010 - DIGITEO - Michael Baudin
//
//  This file is distributed under the same license as the Scilab package.
// =============================================================================
// <-- JVM NOT MANDATORY -->
//
// assert_close --
//   Returns 1 if the two real matrices computed and expected are close,
//   i.e. if the relative distance between computed and expected is lesser than epsilon.
// Arguments
//   computed, expected : the two matrices to compare
//   epsilon : a small number
//
function flag = assert_close ( computed, expected, epsilon )
  if expected==0.0 then
    shift = norm(computed-expected);
  else
    shift = norm(computed-expected)/norm(expected);
  end
  if shift < epsilon then
    flag = 1;
  else
    flag = 0;
  end
  if flag <> 1 then bugmes();quit;end
endfunction
//
// assert_equal --
//   Returns 1 if the two real matrices computed and expected are equal.
// Arguments
//   computed, expected : the two matrices to compare
//   epsilon : a small number
//
function flag = assert_equal ( computed , expected )
  if computed==expected then
    flag = 1;
  else
    flag = 0;
  end
  if flag <> 1 then bugmes();quit;end
endfunction
// With "karmarkar"
// With slack variables:
//
// Min { -20.x1 - 24.x2 } such as:
// 3.x1 + 6.x2 + x3 = 60
// 4.x1 + 2.x2 + x4 = 32
// x1, x2, x3, x4 >= 0
c = [-20 -24 0 0]';
Aeq = [
3 6 1 0
4 2 0 1
];
beq = [60 32]';
xexpected = [4 8 0 0]';
fexpected = -272;
// [x0,kerA]=linsolve(Aeq,-beq)
// x0 = lsq(Aeq,beq) also works
x0 = [
4.1128205
7.7333333
1.2615385
0.0820513
];
[xopt,fopt]=karmarkar(Aeq,beq,c,x0);
assert_close ( xopt , xexpected , 1.e-3 );
assert_close ( fopt , fexpected , 1.e-4 );
//
// Configure the relative tolerance
[xopt,fopt]=karmarkar(Aeq,beq,c,x0,1.e-6);
assert_close ( xopt , xexpected , 1.e-4 );
assert_close ( fopt , fexpected , 1.e-5 );
//
// Configure the gamma
[xopt,fopt]=karmarkar(Aeq,beq,c,x0,1.e-6,0.1);
assert_close ( xopt , xexpected , 1.e-3 );
assert_close ( fopt , fexpected , 1.e-4 );
//
// Check new API (from Scilab v5.3.x).
//
// Check number of iterations
[xopt,fopt,count]=karmarkar(Aeq,beq,c,x0);
assert_close ( xopt , xexpected , 1.e-3 );
assert_close ( fopt , fexpected , 1.e-4 );
assert_equal ( count>10 , %t );
//
// Check number of iterations, with default options
[xopt,fopt,count]=karmarkar(Aeq,beq,c,x0,[],[],10);
assert_equal ( count , 10 );
//
// Check output function
    function stop = myoutputfunction ( iter , xopt , fopt , d )
        norstep = norm(d)
        localmsg = gettext("Iteration #%3.0f, fopt=%10.3e, ||d||=%10.3e\n")
        mprintf(localmsg,iter,fopt,norstep)
        stop = %f
    endfunction
xopt=karmarkar(Aeq,beq,c,x0,[],[],[],myoutputfunction);
Iteration #  0, fopt=-2.679e+002, ||d||=0.000e+000
Iteration #  1, fopt=-2.688e+002, ||d||=3.249e-001
Iteration #  2, fopt=-2.696e+002, ||d||=2.436e-001
Iteration #  3, fopt=-2.701e+002, ||d||=1.827e-001
Iteration #  4, fopt=-2.706e+002, ||d||=1.369e-001
Iteration #  5, fopt=-2.709e+002, ||d||=1.027e-001
Iteration #  6, fopt=-2.711e+002, ||d||=7.695e-002
Iteration #  7, fopt=-2.713e+002, ||d||=5.771e-002
Iteration #  8, fopt=-2.715e+002, ||d||=4.336e-002
Iteration #  9, fopt=-2.716e+002, ||d||=3.271e-002
Iteration # 10, fopt=-2.717e+002, ||d||=2.487e-002
Iteration # 11, fopt=-2.717e+002, ||d||=1.914e-002
Iteration # 12, fopt=-2.718e+002, ||d||=1.493e-002
Iteration # 13, fopt=-2.718e+002, ||d||=1.177e-002
Iteration # 14, fopt=-2.719e+002, ||d||=9.327e-003
Iteration # 15, fopt=-2.719e+002, ||d||=7.373e-003
Iteration # 16, fopt=-2.719e+002, ||d||=5.787e-003
Iteration # 17, fopt=-2.719e+002, ||d||=4.502e-003
Iteration # 18, fopt=-2.720e+002, ||d||=3.471e-003
Iteration # 19, fopt=-2.720e+002, ||d||=2.656e-003
Iteration # 20, fopt=-2.720e+002, ||d||=2.020e-003
Iteration # 21, fopt=-2.720e+002, ||d||=1.530e-003
Iteration # 22, fopt=-2.720e+002, ||d||=1.155e-003
Iteration # 23, fopt=-2.720e+002, ||d||=8.704e-004
Iteration # 24, fopt=-2.720e+002, ||d||=6.548e-004
Iteration # 25, fopt=-2.720e+002, ||d||=4.922e-004
Iteration # 26, fopt=-2.720e+002, ||d||=3.696e-004
Iteration # 27, fopt=-2.720e+002, ||d||=2.775e-004
Iteration # 28, fopt=-2.720e+002, ||d||=2.082e-004
Iteration # 29, fopt=-2.720e+002, ||d||=1.562e-004
Iteration # 30, fopt=-2.720e+002, ||d||=1.172e-004
Iteration # 31, fopt=-2.720e+002, ||d||=8.793e-005
assert_close ( xopt , xexpected , 1.e-3 );
//
// Check output function with additionnal arguments
function stop = myoutputfunction2 ( iter , xopt , fopt , d , myAeq , mybeq , myc )
        norstep = norm(d)
        localmsg = gettext("Iteration #%3.0f, fopt=%10.3e, ||d||=%10.3e, ||Ax-beq||=%.3e\n")
        mprintf(localmsg,iter,fopt,norstep,norm(myAeq*xopt-mybeq))
        stop = %f
    endfunction
xopt=karmarkar(Aeq,beq,c,x0,[],[],[],list(myoutputfunction2,Aeq,beq,c));
Iteration #  0, fopt=-2.679e+002, ||d||=0.000e+000, ||Ax-beq||=2.236e-007
Iteration #  1, fopt=-2.688e+002, ||d||=3.249e-001, ||Ax-beq||=2.236e-007
Iteration #  2, fopt=-2.696e+002, ||d||=2.436e-001, ||Ax-beq||=2.236e-007
Iteration #  3, fopt=-2.701e+002, ||d||=1.827e-001, ||Ax-beq||=2.236e-007
Iteration #  4, fopt=-2.706e+002, ||d||=1.369e-001, ||Ax-beq||=2.236e-007
Iteration #  5, fopt=-2.709e+002, ||d||=1.027e-001, ||Ax-beq||=2.236e-007
Iteration #  6, fopt=-2.711e+002, ||d||=7.695e-002, ||Ax-beq||=2.236e-007
Iteration #  7, fopt=-2.713e+002, ||d||=5.771e-002, ||Ax-beq||=2.236e-007
Iteration #  8, fopt=-2.715e+002, ||d||=4.336e-002, ||Ax-beq||=2.236e-007
Iteration #  9, fopt=-2.716e+002, ||d||=3.271e-002, ||Ax-beq||=2.236e-007
Iteration # 10, fopt=-2.717e+002, ||d||=2.487e-002, ||Ax-beq||=2.236e-007
Iteration # 11, fopt=-2.717e+002, ||d||=1.914e-002, ||Ax-beq||=2.236e-007
Iteration # 12, fopt=-2.718e+002, ||d||=1.493e-002, ||Ax-beq||=2.236e-007
Iteration # 13, fopt=-2.718e+002, ||d||=1.177e-002, ||Ax-beq||=2.236e-007
Iteration # 14, fopt=-2.719e+002, ||d||=9.327e-003, ||Ax-beq||=2.236e-007
Iteration # 15, fopt=-2.719e+002, ||d||=7.373e-003, ||Ax-beq||=2.236e-007
Iteration # 16, fopt=-2.719e+002, ||d||=5.787e-003, ||Ax-beq||=2.236e-007
Iteration # 17, fopt=-2.719e+002, ||d||=4.502e-003, ||Ax-beq||=2.236e-007
Iteration # 18, fopt=-2.720e+002, ||d||=3.471e-003, ||Ax-beq||=2.236e-007
Iteration # 19, fopt=-2.720e+002, ||d||=2.656e-003, ||Ax-beq||=2.236e-007
Iteration # 20, fopt=-2.720e+002, ||d||=2.020e-003, ||Ax-beq||=2.236e-007
Iteration # 21, fopt=-2.720e+002, ||d||=1.530e-003, ||Ax-beq||=2.236e-007
Iteration # 22, fopt=-2.720e+002, ||d||=1.155e-003, ||Ax-beq||=2.236e-007
Iteration # 23, fopt=-2.720e+002, ||d||=8.704e-004, ||Ax-beq||=2.237e-007
Iteration # 24, fopt=-2.720e+002, ||d||=6.548e-004, ||Ax-beq||=2.237e-007
Iteration # 25, fopt=-2.720e+002, ||d||=4.922e-004, ||Ax-beq||=2.238e-007
Iteration # 26, fopt=-2.720e+002, ||d||=3.696e-004, ||Ax-beq||=2.242e-007
Iteration # 27, fopt=-2.720e+002, ||d||=2.775e-004, ||Ax-beq||=2.240e-007
Iteration # 28, fopt=-2.720e+002, ||d||=2.082e-004, ||Ax-beq||=2.238e-007
Iteration # 29, fopt=-2.720e+002, ||d||=1.562e-004, ||Ax-beq||=2.238e-007
Iteration # 30, fopt=-2.720e+002, ||d||=1.172e-004, ||Ax-beq||=2.237e-007
Iteration # 31, fopt=-2.720e+002, ||d||=8.793e-005, ||Ax-beq||=2.230e-007
assert_close ( xopt , xexpected , 1.e-3 );
