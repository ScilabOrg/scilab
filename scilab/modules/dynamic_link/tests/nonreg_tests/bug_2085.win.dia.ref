// =============================================================================
// Scilab ( http://www.scilab.org/ ) - This file is part of Scilab
// Copyright (C) 2008 - INRIA - Allan CORNET
//
//  This file is distributed under the same license as the Scilab package.
// =============================================================================
// <-- ENGLISH IMPOSED -->
// <-- JVM NOT MANDATORY -->
// <-- Non-regression test for bug 2085 -->
//
// <-- Bugzilla URL -->
// http://bugzilla.scilab.org/show_bug.cgi?id=2085
//
// <-- Short Description -->
// this example fails on some pc ???
// exec SCI/modules/dynamic_link/tests/nonreg_tests/bug_2085.tst;
test_path = get_absolute_file_path('bug_2085.tst');
currentpath = pwd();
cd TMPDIR;
cd ../;
OS_TMP_DIR = pwd();
mkdir(OS_TMP_DIR,'bug_2085');
TEST_DIR = OS_TMP_DIR + filesep() + 'bug_2085';
copyfile(SCI+'/modules/dynamic_link/tests/nonreg_tests/bug_2085.c' , TEST_DIR + filesep() + 'bug_2085.c');
chdir(TEST_DIR);
files=['bug_2085.c'];
ilib_build('bug',['ex2c_1','intex2c'],files,[]);
   Generate a gateway file
   Generate a loader file
   Generate a Makefile: Makelib
   Running the makefile
   Compilation of bug_2085.c
   Building shared library (be patient)
   Generate a cleaner file
// load the shared library 
exec loader.sce
 
// This file is released into the public domain
 
// Generated by builder.sce : Please, do not edit this file
 
// ----------------------------------------------------------------------------
 
//
 
if win64() then
  warning(_("This module requires a Windows x86 platform."));
  return
end
 
//
 
bug_path = get_absolute_file_path('loader.sce');
 
//
 
// ulink previous function with same name
 
[bOK, ilib] = c_link('bug');
 
if bOK then
  ulink(ilib);
end
 
//
 
list_functions = [ 'ex2c_1';
];
 
addinter(bug_path + filesep() + 'bug' + getdynlibext(), 'bug', list_functions);
Shared archive loaded.
Link done.
 
// remove temp. variables on stack
 
clear bug_path;
 
clear bOK;
 
clear ilib;
 
clear list_functions;
 
// ----------------------------------------------------------------------------
 
chdir(currentpath);
//using the new primitive
r = [1,2,3];
nr = [4,5,5];
a = ex2c_1(r+%i*nr);
res = (2 * r) +%i*(nr *3);
if a <> res then bugmes();quit;end;
// ulink() all libraries
ulink();
//remove TMP_DIR
rmdir(TEST_DIR,'s');
// =============================================================================
