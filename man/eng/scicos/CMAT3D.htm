<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>CMAT3D</TITLE>
<META NAME="description" CONTENT="CMAT3D">
<META NAME="keywords" CONTENT="CMAT3D">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="CMAT3D.css">

</HEAD>

<BODY bgcolor="#FFFFFF">

<P>
<DIV ALIGN="CENTER">
Scicos Block
<BR><A NAME="tex2html1"
  HREF="../../fr/scicos/CMAT3D.htm">fr</A> - <A NAME="tex2html2"
  HREF="./CMAT3D.htm">eng</A>

</DIV>
<H2><A NAME="SECTION00010000000000000000"></A><A NAME="CMAT3D"></A>
<BR>
CMAT3D title
</H2>
<DIV ALIGN="CENTER">
<!-- MATH
 $\epsfig{file=CMAT3D.eps,width=90.00pt}$
 -->
<IMG
 WIDTH="143" HEIGHT="152" ALIGN="BOTTOM" BORDER="0"
 SRC="../../images/scicos/CMAT3D_blk.gif"
 ALT="\epsfig{file=CMAT3D.eps,width=90.00pt}">

</DIV>
<BR>

<H3><font color="blue"><A NAME="SECTION00020000000000000000">
Contents</A>
</font></H3>
<!--Table of Contents-->

<UL CLASS="TofC">
<LI><A NAME="tex2html4"
  HREF="CMAT3D.htm#SECTION00010000000000000000">CMAT3D title</A>
<UL>
<LI><A NAME="tex2html5"
  HREF="CMAT3D.htm#SECTION00021000000000000000">Palette</A>
<LI><A NAME="tex2html6"
  HREF="CMAT3D.htm#SECTION00022000000000000000">Description</A>
<LI><A NAME="tex2html7"
  HREF="CMAT3D.htm#SECTION00023000000000000000">Dialog box</A>
<LI><A NAME="tex2html8"
  HREF="CMAT3D.htm#SECTION00024000000000000000">Default properties</A>
<LI><A NAME="tex2html9"
  HREF="CMAT3D.htm#SECTION00025000000000000000">Interfacing function</A>
<LI><A NAME="tex2html10"
  HREF="CMAT3D.htm#SECTION00026000000000000000">Computational function (type 4)</A>
<LI><A NAME="tex2html11"
  HREF="CMAT3D.htm#SECTION00027000000000000000">Authors</A>
</UL></UL>
<!--End of Table of Contents-->
<H3><font color="blue"><A NAME="SECTION00021000000000000000">
Palette</A>
</font></H3>

<UL>
<LI><A NAME="tex2html3"
  HREF="Sinks_pal.htm">Sinks - Sinks palette</A>
</LI>
</UL>
<H3><font color="blue"><A NAME="SECTION00022000000000000000">
Description</A>
</font></H3>

<P>
Add here a paragraph of the function description  
<BR>
<H3><font color="blue"><A NAME="SECTION00023000000000000000">
Dialog box</A>
</font></H3>

<DIV ALIGN="CENTER">
<IMG
 WIDTH="477" HEIGHT="186" BORDER="0"
 SRC="../../images/scicos/CMAT3D_gui.gif"
 ALT="\begin{figure}\begin{center}
\epsfig{file=CMAT3D_gui.eps,width=300pt}
\end{center}\end{figure}">
</DIV>

<P>

<UL>
<LI><b>Bounds Vector X (-1 for standard)</b>
<BR>
The parameter description 1.
<BR>
Properties : Type 'vec' of size -1.
</LI>
<LI><b>Bounds Vector Y (-1 for standard)</b>
<BR>
The parameter description 2.
<BR>
Properties : Type 'vec' of size -1.
</LI>
<LI><b>ColorMap</b>
<BR>
The parameter description 3.
<BR>
Properties : Type 'vec' of size -1.
</LI>
<LI><b>Zmin</b>
<BR>
The parameter description 4.
<BR>
Properties : Type 'vec' of size 1.
</LI>
<LI><b>Zmax</b>
<BR>
The parameter description 5.
<BR>
Properties : Type 'vec' of size 1.
</LI>
</UL>

<H3><font color="blue"><A NAME="SECTION00024000000000000000">
Default properties</A>
</font></H3>

<UL>
<LI><b>always active:</b> no
</LI>
<LI><b>direct-feedthrough:</b> yes
</LI>
<LI><b>zero-crossing:</b> no
</LI>
<LI><b>mode:</b> no
</LI>
<LI><b>number/sizes of inputs:</b> 1 / -1
</LI>
<LI><b>number/sizes of outputs:</b> 0 / 
</LI>
<LI><b>number/sizes of activation inputs:</b> 1 / 1
</LI>
<LI><b>number/sizes of activation outputs:</b> 0 / 
</LI>
<LI><b>continuous-time state:</b> no
</LI>
<LI><b>discrete-time state:</b> no
</LI>
<LI><b>name of computational function:</b> <EM>cmat3d</EM>
</LI>
</UL>

<H3><font color="blue"><A NAME="SECTION00025000000000000000">
Interfacing function</A>
</font></H3>
<TT>CMAT3D.sci</TT>

<H3><font color="blue"><A NAME="SECTION00026000000000000000">
Computational function (type 4)</A>
</font></H3>
 <SMALL CLASS="TINY">  </SMALL>
<BR>
<PRE  CLASS="verbatim">/**
   \file cmat3d.c
   \author Benoit Bayol
   \version 1.0
   \date September 2006 - January 2007
   \brief CMAT3D is a scope which connect a matrix to a plot3d. Values of the matrix are the values at the nodes.
   \see CMAT3D.sci in macros/scicos_blocks/Sinks/
*/

#include "scoMemoryScope.h"
#include "scoWindowScope.h"
#include "scoMisc.h"
#include "scoGetProperty.h"
#include "scoSetProperty.h"
#include "scicos_block4.h"

/** \fn cmat3d_draw(scicos_block * block, ScopeMemory ** pScopeMemory, int firstdraw)
    \brief Function to draw or redraw the window
*/
void cmat3d_draw(scicos_block * block, ScopeMemory ** pScopeMemory, int firstdraw)
{
  /*Declarations*/
  int i; //As usual
  int * ipar; //Integer Parameters
  int win_pos[2]; //Position of the Window
  int win_dim[2]; //Dimension of the Window
  int dimension = 3;
  double * rpar; //Reals parameters
  double  ymin, ymax; //Ymin and Ymax are vectors here
  double  xmin, xmax;
  double zmin, zmax;
  int number_of_curves_by_subwin;
  int number_of_subwin;
  double * mat;
  int size_mat;
  int size_in_x;
  int size_in_y;
  scoGraphicalObject pShortDraw;

  /*Retrieve parameters from the scicos_model() which has been created thanks to the interfacing function*/
  rpar = GetRparPtrs(block);
  ipar = GetIparPtrs(block);

  number_of_subwin = 1;

  win_pos[0] = -1;
  win_pos[1] = -1;
  win_dim[0] = -1;
  win_dim[1] = -1;

  size_mat = ipar[2];
  mat = (double*)scicos_malloc(size_mat*sizeof(double));
  for(i = 0 ; i &lt; size_mat ; i++)
    {
      mat[i] = rpar[i];
    }
  size_in_x = GetInPortSize(block,1,1);
  size_in_y = GetInPortSize(block,1,2);
  if(ipar[3] == 1)
    {
      xmax = size_in_x;
      xmin = 0;
      ymax = size_in_y;
      ymin = 0;
    }
  else
    {
      xmin = rpar[size_mat];
      xmax = rpar[size_mat+1];
      ymin = rpar[size_mat+2];
      ymax = rpar[size_mat+3];
    }

  zmin = ipar[0];
  zmax = ipar[1];
  number_of_curves_by_subwin = 1;

  /*Allocating memory for scope only if the window has to be created and not redraw*/
  if(firstdraw == 1)
    {
      scoInitScopeMemory(block-&gt;work,pScopeMemory, number_of_subwin, &amp;number_of_curves_by_subwin);
    }

  /*Creating the Scope with axes*/
  scoInitOfWindow(*pScopeMemory, dimension, -1, win_pos, win_dim, &amp;xmin, &amp;xmax, &amp;ymin, &amp;ymax, &amp;zmin, &amp;zmax);

  /*Here we put the special window feature like pixmap or text title
   Dont forget that the function scoAddTitleScope redraws the window at end so it would be a good idea to put it at the end*/
  pFIGURE_FEATURE(scoGetPointerScopeWindow(*pScopeMemory))-&gt;pixmap = 1;
  pFIGURE_FEATURE(scoGetPointerScopeWindow(*pScopeMemory))-&gt;wshow = 1;

  sciSetColormap(scoGetPointerScopeWindow(*pScopeMemory), mat , size_mat/3, 3);

  pSUBWIN_FEATURE(scoGetPointerAxes(*pScopeMemory,0))-&gt;alpha = 50;
  pSUBWIN_FEATURE(scoGetPointerAxes(*pScopeMemory,0))-&gt;theta = 280;
  
  /*Adding graphic elements like plot3d or polyline and so*/
  if(ipar[3] == 1)
    {
      scoAddPlot3dForShortDraw(*pScopeMemory,0,0,GetInPortSize(block,1,1),GetInPortSize(block,1,2));
    }
  else
    {
	  double h_x,h_y;
      scoAddPlot3dForShortDraw(*pScopeMemory,0,0,GetInPortSize(block,1,1),GetInPortSize(block,1,2));
      pShortDraw = scoGetPointerShortDraw(*pScopeMemory,0,0);
      h_x = fabs((xmax-xmin)/(GetInPortSize(block,1,1)-1));
      h_y = fabs((ymax-ymin)/(GetInPortSize(block,1,2)-1));
      
      for(i = 0 ; i &lt; size_in_x ; i++)
	{
	  pSURFACE_FEATURE(pShortDraw)-&gt;pvecx[i] = xmin + i*h_x;
	} 
      for(i = 0 ; i &lt; size_in_y ; i++)
	{
	  pSURFACE_FEATURE(pShortDraw)-&gt;pvecy[i] = ymin + i*h_y;
	} 
    }
  scoAddTitlesScope(*pScopeMemory,"x","y","z");

  /*Dont forget to free your scicos_malloc or MALLOC*/
  scicos_free(mat);

}

/** \fn void cmat3d(scicos_block * block, int flag)
    \brief the computational function
    \param block A pointer to a scicos_block
    \param flag An integer which indicates the state of the block (init, update, ending)
*/
void cmat3d(scicos_block * block, int flag)
{
  /* Declarations */
  ScopeMemory * pScopeMemory;
  scoGraphicalObject pShortDraw;
  double * u1;
  int i,j;
  int dim_i, dim_j;
 
  /* State Machine Control */
  switch(flag)
    {
    /*Flag 4*/
    case Initialization:
      {
        /*We create the window for the first time, so 1 is in parameters*/
	cmat3d_draw(block,&amp;pScopeMemory,1);
	break; //dont forget the break
      }
    /*Flag 2*/
    case StateUpdate:
      {
	/*Retreiving Scope in the block-&gt;work*/
	scoRetrieveScopeMemory(block-&gt;work,&amp;pScopeMemory);

	/* If window has been destroyed we recreate it */
	if(scoGetPointerScopeWindow(pScopeMemory) == NULL)
	  {
            //0 here because of the recreation
	    cmat3d_draw(block,&amp;pScopeMemory,0);
	  }
        /*Here some allocations and calcul wich are necessary*/
	pShortDraw = scoGetPointerShortDraw(pScopeMemory,0,0);

	u1 = GetInPortPtrs(block,1);
	dim_i = GetInPortRows(block,1);
	dim_j = GetInPortCols(block,1);

	for(i = 0 ; i &lt; dim_i ; i++)
	  {
	    
	    for(j = 0; j &lt; dim_j ; j++)
	      {
		pSURFACE_FEATURE(pShortDraw)-&gt;pvecz[j+i*dim_j] = u1[j+dim_j*i];
	      }
	  }
        
        /*Here is the draw instructions*/
	sciSetUsedWindow(scoGetWindowID(pScopeMemory));
	if(pFIGURE_FEATURE(scoGetPointerScopeWindow(pScopeMemory))-&gt;pixmap == 1)
	  {
	    C2F(dr)("xset","wshow",PI0,PI0,PI0,PI0,PI0,PI0,PD0,PD0,PD0,PD0,0L,0L);
	  }
	sciDrawObj(scoGetPointerScopeWindow(pScopeMemory));

	break; //dont forget the break
      }
    /*Flag 5*/
    case Ending:
      {
        /*Retrieve Memory*/
	scoRetrieveScopeMemory(block-&gt;work, &amp;pScopeMemory);
        /*Here we can add specific instructions to be sure that we have stick short and longdraw if we need it. Cscope for example stick the last short to the long to have one curve to move*/
        /*Free Memory*/
	scoFreeScopeMemory(block-&gt;work, &amp;pScopeMemory);
	break;
      }
    }
}
</PRE>

<H3><font color="blue"><A NAME="SECTION00027000000000000000">
Authors</A>
</font></H3>
<b>enter here the author name</b> Add here the author  references

<BR>




</BODY>
</HTML>
